static const uint WIDTH = 8u;
static const uint HEIGHT = 16u;
static const uint4 font_data[96] = {
    uint4(0x00000000, 0x00000000, 0x00000000, 0x00000000), // 0x20: ' '
    uint4(0x00001010, 0x10101010, 0x10001010, 0x00000000), // 0x21: '!'
    uint4(0x00242424, 0x00000000, 0x00000000, 0x00000000), // 0x22: '"'
    uint4(0x00002424, 0x247E2424, 0x7E242424, 0x00000000), // 0x23: '#'
    uint4(0x0010107C, 0x9290907C, 0x1212927C, 0x10100000), // 0x24: '$'
    uint4(0x00006494, 0x68081010, 0x202C524C, 0x00000000), // 0x25: '%'
    uint4(0x00001824, 0x2418304A, 0x4444443A, 0x00000000), // 0x26: '&'
    uint4(0x00101010, 0x00000000, 0x00000000, 0x00000000), // 0x27: '\''
    uint4(0x00000810, 0x20202020, 0x20201008, 0x00000000), // 0x28: '('
    uint4(0x00002010, 0x08080808, 0x08081020, 0x00000000), // 0x29: ')'
    uint4(0x00000000, 0x0024187E, 0x18240000, 0x00000000), // 0x2A: '*'
    uint4(0x00000000, 0x0010107C, 0x10100000, 0x00000000), // 0x2B: '+'
    uint4(0x00000000, 0x00000000, 0x00001010, 0x20000000), // 0x2C: ','
    uint4(0x00000000, 0x0000007E, 0x00000000, 0x00000000), // 0x2D: '-'
    uint4(0x00000000, 0x00000000, 0x00001010, 0x00000000), // 0x2E: '.'
    uint4(0x00000404, 0x08081010, 0x20204040, 0x00000000), // 0x2F: '/'
    uint4(0x00003C42, 0x42464A52, 0x6242423C, 0x00000000), // 0x30: '0'
    uint4(0x00000818, 0x28080808, 0x0808083E, 0x00000000), // 0x31: '1'
    uint4(0x00003C42, 0x42020408, 0x1020407E, 0x00000000), // 0x32: '2'
    uint4(0x00003C42, 0x42021C02, 0x0242423C, 0x00000000), // 0x33: '3'
    uint4(0x00000206, 0x0A122242, 0x7E020202, 0x00000000), // 0x34: '4'
    uint4(0x00007E40, 0x40407C02, 0x0202423C, 0x00000000), // 0x35: '5'
    uint4(0x00001C20, 0x40407C42, 0x4242423C, 0x00000000), // 0x36: '6'
    uint4(0x00007E02, 0x02040408, 0x08101010, 0x00000000), // 0x37: '7'
    uint4(0x00003C42, 0x42423C42, 0x4242423C, 0x00000000), // 0x38: '8'
    uint4(0x00003C42, 0x4242423E, 0x02020438, 0x00000000), // 0x39: '9'
    uint4(0x00000000, 0x00101000, 0x00001010, 0x00000000), // 0x3A: ':'
    uint4(0x00000000, 0x00101000, 0x00001010, 0x20000000), // 0x3B: ';'
    uint4(0x00000004, 0x08102040, 0x20100804, 0x00000000), // 0x3C: '<'
    uint4(0x00000000, 0x007E0000, 0x7E000000, 0x00000000), // 0x3D: '='
    uint4(0x00000040, 0x20100804, 0x08102040, 0x00000000), // 0x3E: '>'
    uint4(0x00003C42, 0x42420408, 0x08000808, 0x00000000), // 0x3F: '?'
    uint4(0x00007C82, 0x9EA2A2A2, 0xA69A807E, 0x00000000), // 0x40: '@'
    uint4(0x00003C42, 0x4242427E, 0x42424242, 0x00000000), // 0x41: 'A'
    uint4(0x00007C42, 0x42427C42, 0x4242427C, 0x00000000), // 0x42: 'B'
    uint4(0x00003C42, 0x42404040, 0x4042423C, 0x00000000), // 0x43: 'C'
    uint4(0x00007844, 0x42424242, 0x42424478, 0x00000000), // 0x44: 'D'
    uint4(0x00007E40, 0x40407840, 0x4040407E, 0x00000000), // 0x45: 'E'
    uint4(0x00007E40, 0x40407840, 0x40404040, 0x00000000), // 0x46: 'F'
    uint4(0x00003C42, 0x4240404E, 0x4242423C, 0x00000000), // 0x47: 'G'
    uint4(0x00004242, 0x42427E42, 0x42424242, 0x00000000), // 0x48: 'H'
    uint4(0x00003810, 0x10101010, 0x10101038, 0x00000000), // 0x49: 'I'
    uint4(0x00000E04, 0x04040404, 0x04444438, 0x00000000), // 0x4A: 'J'
    uint4(0x00004244, 0x48506060, 0x50484442, 0x00000000), // 0x4B: 'K'
    uint4(0x00004040, 0x40404040, 0x4040407E, 0x00000000), // 0x4C: 'L'
    uint4(0x000082C6, 0xAA928282, 0x82828282, 0x00000000), // 0x4D: 'M'
    uint4(0x00004242, 0x4262524A, 0x46424242, 0x00000000), // 0x4E: 'N'
    uint4(0x00003C42, 0x42424242, 0x4242423C, 0x00000000), // 0x4F: 'O'
    uint4(0x00007C42, 0x4242427C, 0x40404040, 0x00000000), // 0x50: 'P'
    uint4(0x00003C42, 0x42424242, 0x42424A3C, 0x02000000), // 0x51: 'Q'
    uint4(0x00007C42, 0x4242427C, 0x50484442, 0x00000000), // 0x52: 'R'
    uint4(0x00003C42, 0x40403C02, 0x0242423C, 0x00000000), // 0x53: 'S'
    uint4(0x0000FE10, 0x10101010, 0x10101010, 0x00000000), // 0x54: 'T'
    uint4(0x00004242, 0x42424242, 0x4242423C, 0x00000000), // 0x55: 'U'
    uint4(0x00004242, 0x42424224, 0x24241818, 0x00000000), // 0x56: 'V'
    uint4(0x00008282, 0x82828282, 0x92AAC682, 0x00000000), // 0x57: 'W'
    uint4(0x00004242, 0x24241818, 0x24244242, 0x00000000), // 0x58: 'X'
    uint4(0x00008282, 0x44442810, 0x10101010, 0x00000000), // 0x59: 'Y'
    uint4(0x00007E02, 0x02040810, 0x2040407E, 0x00000000), // 0x5A: 'Z'
    uint4(0x00003820, 0x20202020, 0x20202038, 0x00000000), // 0x5B: '['
    uint4(0x00004040, 0x20201010, 0x08080404, 0x00000000), // 0x5C: '\\'
    uint4(0x00003808, 0x08080808, 0x08080838, 0x00000000), // 0x5D: ']'
    uint4(0x00102844, 0x00000000, 0x00000000, 0x00000000), // 0x5E: '^'
    uint4(0x00000000, 0x00000000, 0x00000000, 0x007E0000), // 0x5F: '_'
    uint4(0x10080000, 0x00000000, 0x00000000, 0x00000000), // 0x60: '`'
    uint4(0x00000000, 0x003C023E, 0x4242423E, 0x00000000), // 0x61: 'a'
    uint4(0x00004040, 0x407C4242, 0x4242427C, 0x00000000), // 0x62: 'b'
    uint4(0x00000000, 0x003C4240, 0x4040423C, 0x00000000), // 0x63: 'c'
    uint4(0x00000202, 0x023E4242, 0x4242423E, 0x00000000), // 0x64: 'd'
    uint4(0x00000000, 0x003C4242, 0x7E40403C, 0x00000000), // 0x65: 'e'
    uint4(0x00000E10, 0x107C1010, 0x10101010, 0x00000000), // 0x66: 'f'
    uint4(0x00000000, 0x003E4242, 0x4242423E, 0x02023C00), // 0x67: 'g'
    uint4(0x00004040, 0x407C4242, 0x42424242, 0x00000000), // 0x68: 'h'
    uint4(0x00001010, 0x00301010, 0x10101038, 0x00000000), // 0x69: 'i'
    uint4(0x00000404, 0x000C0404, 0x04040404, 0x44443800), // 0x6A: 'j'
    uint4(0x00004040, 0x40424448, 0x70484442, 0x00000000), // 0x6B: 'k'
    uint4(0x00003010, 0x10101010, 0x10101038, 0x00000000), // 0x6C: 'l'
    uint4(0x00000000, 0x00FC9292, 0x92929292, 0x00000000), // 0x6D: 'm'
    uint4(0x00000000, 0x007C4242, 0x42424242, 0x00000000), // 0x6E: 'n'
    uint4(0x00000000, 0x003C4242, 0x4242423C, 0x00000000), // 0x6F: 'o'
    uint4(0x00000000, 0x007C4242, 0x4242427C, 0x40404000), // 0x70: 'p'
    uint4(0x00000000, 0x003E4242, 0x4242423E, 0x02020200), // 0x71: 'q'
    uint4(0x00000000, 0x005E6040, 0x40404040, 0x00000000), // 0x72: 'r'
    uint4(0x00000000, 0x003E4040, 0x3C02027C, 0x00000000), // 0x73: 's'
    uint4(0x00001010, 0x107C1010, 0x1010100E, 0x00000000), // 0x74: 't'
    uint4(0x00000000, 0x00424242, 0x4242423E, 0x00000000), // 0x75: 'u'
    uint4(0x00000000, 0x00424242, 0x24241818, 0x00000000), // 0x76: 'v'
    uint4(0x00000000, 0x00828292, 0x9292927C, 0x00000000), // 0x77: 'w'
    uint4(0x00000000, 0x00424224, 0x18244242, 0x00000000), // 0x78: 'x'
    uint4(0x00000000, 0x00424242, 0x4242423E, 0x02023C00), // 0x79: 'y'
    uint4(0x00000000, 0x007E0408, 0x1020407E, 0x00000000), // 0x7A: 'z'
    uint4(0x00000C10, 0x10102010, 0x1010100C, 0x00000000), // 0x7B: '{'
    uint4(0x00001010, 0x10101010, 0x10101010, 0x00000000), // 0x7C: '|'
    uint4(0x00003008, 0x08080408, 0x08080830, 0x00000000), // 0x7D: '}'
    uint4(0x0062928C, 0x00000000, 0x00000000, 0x00000000), // 0x7E: '~'
    uint4(0x08100000, 0x00000000, 0x00000000, 0x00000000), // 0x7F: BACKSPACE
};

struct TextLineUBO
{
    uint words[68];
    int4 origin_px_and_word_count;
    float4 fg;
    float4 bg;
};

[[vk::binding(1, 0)]]
ConstantBuffer<TextLineUBO> text_line;

bool GlyphPixel(uint glyph_idx, uint x, uint y)
{
    uint rows = font_data[glyph_idx][y / 4u];
    uint row = (rows >> (8u * (3u - (y % 4u)))) & 0xFFu;
    uint bit = (row >> (7u - x)) & 1u;
    return bit != 0u;
}

struct PSInput
{
    float4 position : SV_Position;
};

float4 main(PSInput input) : SV_Target
{
    int2 frag_xy = int2(floor(input.position.xy));

    int2 top_left_pos = frag_xy - text_line.origin_px_and_word_count.xy;
    if (top_left_pos.x < 0)
        discard;
    if (top_left_pos.y < 0)
        discard;
    if (top_left_pos.y >= int(HEIGHT))
        discard;

    uint line_width_px = text_line.origin_px_and_word_count.z * 4u * WIDTH;
    if (top_left_pos.x >= int(line_width_px)) {
        discard;
    }

    int cx = top_left_pos.x / int(WIDTH);
    int gx = top_left_pos.x % int(WIDTH);

    uint word_index = uint(cx / 4);
    uint byte_shift = uint(cx % 4) * 8u;

    uint ch = (text_line.words[word_index] >> byte_shift) & 0xFFu;

    if (ch != 0u && GlyphPixel(ch - 0x20u, uint(gx), uint(top_left_pos.y)))
    {
        return text_line.fg;
    }
    else
    {
        return text_line.bg;
    }
}